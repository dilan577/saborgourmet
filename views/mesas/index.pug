extends ../layouts/main

block content
  .px-4.sm_px-0
    .flex.justify-between.items-center
      div
        h1.text-3xl.font-bold.text-gray-900= titulo
        p.mt-2.text-sm.text-gray-600 Administra las mesas del restaurante
      a.btn-primary(href="/mesas/crear") Crear Mesa
      a.btn-secondary(href="/admin") Volver  

  
  if locals.mensaje
    .mt-4.bg-green-100.border.border-green-400.text-green-700.px-4.py-3.rounded
      p= mensaje
  
  if locals.error
    .mt-4.bg-red-100.border.border-red-400.text-red-700.px-4.py-3.rounded
      p= error
  
  .mt-8.card
    .overflow-x-auto
      table.min-w-full.divide-y.divide-gray-200
        thead.bg-gray-50
          tr
            th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Número
            th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Capacidad
            th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Zona
            th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Estado
            th.px-6.py-3.text-left.text-xs.font-medium.text-gray-500.uppercase Acciones
        tbody.bg-white.divide-y.divide-gray-200
          each mesa in mesas
            tr
              td.px-6.py-4.whitespace-nowrap.text-sm.font-medium.text-gray-900= mesa.numero
              td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-900= `${mesa.capacidad} personas`
              td.px-6.py-4.whitespace-nowrap.text-sm.text-gray-900= mesa.zona
              td.px-6.py-4.whitespace-nowrap
                span.badge(class={"badge-success": mesa.activa, "badge-danger": !mesa.activa})= mesa.activa ? 'Activa' : 'Inactiva'
              td.px-6.py-4.whitespace-nowrap.text-sm.space-x-2
                a.text-blue-600.hover_text-blue-900(href=`/mesas/${mesa.id}/editar`) Editar
                button.text-yellow-600.hover_text-yellow-900(onclick=`toggleEstado(${mesa.id})`)= mesa.activa ? 'Desactivar' : 'Activar'
                button.text-red-600.hover_text-red-900(onclick=`eliminar(${mesa.id})`) Eliminar
  
  script.
    async function toggleEstado(id) {
      if (!confirm('¿Estás seguro de cambiar el estado de esta mesa?')) return;
      
      try {
        const response = await fetch(`/mesas/${id}/toggle`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.success) {
          window.location.reload();
        } else {
          alert(data.error || 'Error al cambiar estado');
        }
      } catch (error) {
        alert('Error al cambiar estado de la mesa');
      }
    }
    
    async function eliminar(id) {
      if (!confirm('¿Estás seguro de eliminar esta mesa?')) return;
      
      try {
        const response = await fetch(`/mesas/${id}`, {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' }
        });
        
        const data = await response.json();
        
        if (data.success) {
          window.location.reload();
        } else {
          alert(data.error || 'Error al eliminar');
        }
      } catch (error) {
        alert('Error al eliminar la mesa');
      }
    }
